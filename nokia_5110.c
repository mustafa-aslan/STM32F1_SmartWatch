// Header: NOKIA 5110
// File Name: nokia_5110.c
// Author: Mustafa Aslan
// Date: 25.10.2015

#include "nokia_5110.h"

const unsigned char Font6X8[][6] = { 
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },   // bosluk
    { 0x00, 0x00, 0x00, 0x2f, 0x00, 0x00 },   // !
    { 0x00, 0x00, 0x07, 0x00, 0x07, 0x00 },   // "
    { 0x00, 0x14, 0x7f, 0x14, 0x7f, 0x14 },   // #
    { 0x00, 0x24, 0x2a, 0x7f, 0x2a, 0x12 },   // $
    { 0x00, 0x62, 0x64, 0x08, 0x13, 0x23 },   // %
    { 0x00, 0x36, 0x49, 0x55, 0x22, 0x50 },   // &
    { 0x00, 0x00, 0x05, 0x03, 0x00, 0x00 },   // '
    { 0x00, 0x00, 0x1c, 0x22, 0x41, 0x00 },   // (
    { 0x00, 0x00, 0x41, 0x22, 0x1c, 0x00 },   // )
    { 0x00, 0x14, 0x08, 0x3E, 0x08, 0x14 },   // *
    { 0x00, 0x08, 0x08, 0x3E, 0x08, 0x08 },   // +
    { 0x00, 0x00, 0x00, 0xA0, 0x60, 0x00 },   // ,
    { 0x00, 0x08, 0x08, 0x08, 0x08, 0x08 },   // -
    { 0x00, 0x00, 0x60, 0x60, 0x00, 0x00 },   // .
    { 0x00, 0x20, 0x10, 0x08, 0x04, 0x02 },   // /
    { 0x00, 0x3E, 0x51, 0x49, 0x45, 0x3E },   // 0
    { 0x00, 0x00, 0x42, 0x7F, 0x40, 0x00 },   // 1
    { 0x00, 0x42, 0x61, 0x51, 0x49, 0x46 },   // 2
    { 0x00, 0x21, 0x41, 0x45, 0x4B, 0x31 },   // 3
    { 0x00, 0x18, 0x14, 0x12, 0x7F, 0x10 },   // 4
    { 0x00, 0x27, 0x45, 0x45, 0x45, 0x39 },   // 5
    { 0x00, 0x3C, 0x4A, 0x49, 0x49, 0x30 },   // 6
    { 0x00, 0x01, 0x71, 0x09, 0x05, 0x03 },   // 7
    { 0x00, 0x36, 0x49, 0x49, 0x49, 0x36 },   // 8
    { 0x00, 0x06, 0x49, 0x49, 0x29, 0x1E },   // 9
    { 0x00, 0x00, 0x36, 0x36, 0x00, 0x00 },   // :
    { 0x00, 0x00, 0x56, 0x36, 0x00, 0x00 },   // ;
    { 0x00, 0x08, 0x14, 0x22, 0x41, 0x00 },   // <
    { 0x00, 0x14, 0x14, 0x14, 0x14, 0x14 },   // =
    { 0x00, 0x00, 0x41, 0x22, 0x14, 0x08 },   // >
    { 0x00, 0x02, 0x01, 0x51, 0x09, 0x06 },   // ?
    { 0x00, 0x32, 0x49, 0x59, 0x51, 0x3E },   // @
    { 0x00, 0x7C, 0x12, 0x11, 0x12, 0x7C },   // A
    { 0x00, 0x7F, 0x49, 0x49, 0x49, 0x36 },   // B
    { 0x00, 0x3E, 0x41, 0x41, 0x41, 0x22 },   // C
    { 0x00, 0x7F, 0x41, 0x41, 0x22, 0x1C },   // D
    { 0x00, 0x7F, 0x49, 0x49, 0x49, 0x41 },   // E
    { 0x00, 0x7F, 0x09, 0x09, 0x09, 0x01 },   // F
    { 0x00, 0x3E, 0x41, 0x49, 0x49, 0x7A },   // G
    { 0x00, 0x7F, 0x08, 0x08, 0x08, 0x7F },   // H
    { 0x00, 0x00, 0x41, 0x7F, 0x41, 0x00 },   // I
    { 0x00, 0x20, 0x40, 0x41, 0x3F, 0x01 },   // J
    { 0x00, 0x7F, 0x08, 0x14, 0x22, 0x41 },   // K
    { 0x00, 0x7F, 0x40, 0x40, 0x40, 0x40 },   // L
    { 0x00, 0x7F, 0x02, 0x0C, 0x02, 0x7F },   // M
    { 0x00, 0x7F, 0x04, 0x08, 0x10, 0x7F },   // N
    { 0x00, 0x3E, 0x41, 0x41, 0x41, 0x3E },   // O
    { 0x00, 0x7F, 0x09, 0x09, 0x09, 0x06 },   // P
    { 0x00, 0x3E, 0x41, 0x51, 0x21, 0x5E },   // Q
    { 0x00, 0x7F, 0x09, 0x19, 0x29, 0x46 },   // R
    { 0x00, 0x46, 0x49, 0x49, 0x49, 0x31 },   // S
    { 0x00, 0x01, 0x01, 0x7F, 0x01, 0x01 },   // T
    { 0x00, 0x3F, 0x40, 0x40, 0x40, 0x3F },   // U
    { 0x00, 0x1F, 0x20, 0x40, 0x20, 0x1F },   // V
    { 0x00, 0x3F, 0x40, 0x38, 0x40, 0x3F },   // W
    { 0x00, 0x63, 0x14, 0x08, 0x14, 0x63 },   // X
    { 0x00, 0x07, 0x08, 0x70, 0x08, 0x07 },   // Y
    { 0x00, 0x61, 0x51, 0x49, 0x45, 0x43 },   // Z
    { 0x00, 0x00, 0x7F, 0x41, 0x41, 0x00 },   // [
    { 0x00, 0x55, 0x2A, 0x55, 0x2A, 0x55 },   // 55
    { 0x00, 0x00, 0x41, 0x41, 0x7F, 0x00 },   // ]
    { 0x00, 0x04, 0x02, 0x01, 0x02, 0x04 },   // ^
    { 0x00, 0x40, 0x40, 0x40, 0x40, 0x40 },   // _
    { 0x00, 0x00, 0x01, 0x02, 0x04, 0x00 },   // '
    { 0x00, 0x20, 0x54, 0x54, 0x54, 0x78 },   // a
    { 0x00, 0x7F, 0x48, 0x44, 0x44, 0x38 },   // b
    { 0x00, 0x38, 0x44, 0x44, 0x44, 0x20 },   // c
    { 0x00, 0x38, 0x44, 0x44, 0x48, 0x7F },   // d
    { 0x00, 0x38, 0x54, 0x54, 0x54, 0x18 },   // e
    { 0x00, 0x08, 0x7E, 0x09, 0x01, 0x02 },   // f
    { 0x00, 0x18, 0xA4, 0xA4, 0xA4, 0x7C },   // g
    { 0x00, 0x7F, 0x08, 0x04, 0x04, 0x78 },   // h
    { 0x00, 0x00, 0x44, 0x7D, 0x40, 0x00 },   // i
    { 0x00, 0x40, 0x80, 0x84, 0x7D, 0x00 },   // j
    { 0x00, 0x7F, 0x10, 0x28, 0x44, 0x00 },   // k
    { 0x00, 0x00, 0x41, 0x7F, 0x40, 0x00 },   // l
    { 0x00, 0x7C, 0x04, 0x18, 0x04, 0x78 },   // m
    { 0x00, 0x7C, 0x08, 0x04, 0x04, 0x78 },   // n
    { 0x00, 0x38, 0x44, 0x44, 0x44, 0x38 },   // o
    { 0x00, 0xFC, 0x24, 0x24, 0x24, 0x18 },   // p
    { 0x00, 0x18, 0x24, 0x24, 0x18, 0xFC },   // q
    { 0x00, 0x7C, 0x08, 0x04, 0x04, 0x08 },   // r
    { 0x00, 0x48, 0x54, 0x54, 0x54, 0x20 },   // s
    { 0x00, 0x04, 0x3F, 0x44, 0x40, 0x20 },   // t
    { 0x00, 0x3C, 0x40, 0x40, 0x20, 0x7C },   // u
    { 0x00, 0x1C, 0x20, 0x40, 0x20, 0x1C },   // v
    { 0x00, 0x3C, 0x40, 0x30, 0x40, 0x3C },   // w
    { 0x00, 0x44, 0x28, 0x10, 0x28, 0x44 },   // x
    { 0x00, 0x1C, 0xA0, 0xA0, 0xA0, 0x7C },   // y
    { 0x00, 0x44, 0x64, 0x54, 0x4C, 0x44 },   // z
};

void Basic_Spi (uint8_t spi_value){
HAL_GPIO_WritePin(GPIOA, CE, GPIO_PIN_RESET); // Display chipi aktif.
	for(int bit = 7; bit>-1; bit--){	// Bit kaydirma islemi ilk, sekizcinci bitten basliyacak.
			if(spi_value & (1 << bit)){		// Bit birse.
					HAL_GPIO_WritePin(GPIOA, DIN, GPIO_PIN_SET);
					HAL_GPIO_WritePin(GPIOA, CLK, GPIO_PIN_RESET);
					HAL_GPIO_WritePin(GPIOA, CLK, GPIO_PIN_SET);
			}else{	//Bit sifirsa.
					HAL_GPIO_WritePin(GPIOA, DIN, GPIO_PIN_RESET);
					HAL_GPIO_WritePin(GPIOA, CLK, GPIO_PIN_RESET);
					HAL_GPIO_WritePin(GPIOA, CLK, GPIO_PIN_SET);
			}	
	}
HAL_GPIO_WritePin(GPIOA, CE, GPIO_PIN_SET); // Display chipi aktif degil.
}

void Function_Set (uint8_t pd_select, uint8_t v_select, uint8_t h_select){
	HAL_GPIO_WritePin(GPIOA, DC, COMMAND); // Komut.	
	Basic_Spi (pd_select | v_select | h_select | 32); 
}

void Write_Data (uint8_t write_data){
	HAL_GPIO_WritePin(GPIOA, DC, DATA);	// Data.
	Basic_Spi (write_data);
}

void Write_Char(unsigned char write_char){
	write_char -= 32;	// ASCII taplosundaki char degerine esitlemek icin.
	for(char _6line = 0; _6line < 6; _6line++){
		Write_Data(Font6X8[write_char][_6line]);
	}
}

void Write_String(char* write_string){
	while(*write_string){
		Write_Char(*write_string++);
	}
}

void Write_Number(uint8_t x_address, uint8_t y_address, uint16_t number){
	Function_Set(PD_RESET, V_RESET, H_RESET);
	Set_Address(x_address, y_address);
	// ORNEK SAYI:  1429 
	// number%10	 --> 1429 % 10 = 9
	uint8_t Ones = number % 10; // Birler basamagi.
	
	// number / 10 		     --> 1429 / 10 = 142
	// (number / 10) % 10  --> 142 % 10  = 2
	uint8_t Tens= ((number % 100) - Ones)/10; // 
	
	// number / 100         --> 1429 / 100 = 14
	// (number / 100) % 10  --> 14 % 10 = 4                  
	uint8_t Hundreds = (number / 100) % 10; // Yuzler basamagi.
	
	//number / 1000         --> 1429 / 1000 = 1
	uint8_t Thousands = number / 1000; // Binler basamagi.

	Write_Char(Thousands + 48); // ASCII taplosundaki char degerine esitlemek icin.
	Write_Char(Hundreds + 48);
	Write_Char(Tens + 48);
	Write_Char(Ones + 48);
}

void Write_Three_Number(uint8_t x_address, uint8_t y_address, uint16_t number){
	Set_Address(x_address, y_address);
	// ORNEK SAYI:  1429 
	// number%10	 --> 1429 % 10 = 9
	uint8_t Ones = number % 10; // Birler basamagi.
	
	// number / 10 		     --> 1429 / 10 = 142
	// (number / 10) % 10  --> 142 % 10  = 2
	uint8_t Tens = ((number % 100) - Ones)/10; // 
	
	// number / 100         --> 1429 / 100 = 14
	// (number / 100) % 10  --> 14 % 10 = 4                  
	uint8_t Hundreds = (number / 100) % 10; // Yuzler basamagi.
	
	Write_Char(Hundreds + 48);
	Write_Char(Tens + 48);
	Write_Char(Ones + 48);
}

void Write_Two_Number(uint8_t x_address, uint8_t y_address, uint16_t number){
	Set_Address(x_address, y_address);
	// ORNEK SAYI:  1429 
	// number%10	 --> 1429 % 10 = 9
	uint8_t Ones = number % 10; // Birler basamagi.
	
	// number / 10 		     --> 1429 / 10 = 142
	// (number / 10) % 10  --> 142 % 10  = 2
	uint8_t Tens = ((number % 100) - Ones)/10; // 
	
	Write_Char(Tens + 48);
	Write_Char(Ones + 48);
}

void Display_Control(uint8_t display_mode_select){
	HAL_GPIO_WritePin(GPIOA, DC, COMMAND);	// Komut.
	Basic_Spi(display_mode_select | 8);
}

void Set_Address(uint8_t x_address, uint8_t y_address){
	HAL_GPIO_WritePin (GPIOA, DC, COMMAND);	// Komut.
	Basic_Spi(x_address | 0x80); // x_address [0,84] araliginda.
	Basic_Spi(y_address | 0x40); // x_address [0,5] araliginda.
}

void Temperature_Control (uint8_t set_temperature_coeffcient){
	HAL_GPIO_WritePin(GPIOA, DC, COMMAND); // Komut.	
	Basic_Spi(set_temperature_coeffcient | 4);
}

void Bias_System (uint8_t set_bias_system){
	HAL_GPIO_WritePin(GPIOA, DC, COMMAND); // Komut.
	Basic_Spi(set_bias_system | 16);
}

void Set_Vop(uint8_t set_vop){
	HAL_GPIO_WritePin(GPIOA, DC, COMMAND); // Komut.
	Basic_Spi(set_vop | 128);
}

void Command_Data(uint8_t command){
	HAL_GPIO_WritePin(GPIOA, DC, COMMAND); // Komut.
	Basic_Spi(command);	
}

void Clear_Display(void){
	for(uint16_t clear = 0; clear < (84*48)/8; clear++){
		Basic_Spi(0x00);
	}
}

void Example_Setting(void){
	HAL_GPIO_WritePin(GPIOA, RST, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(GPIOA, RST, GPIO_PIN_SET);
	
	Function_Set(PD_RESET, V_RESET, H_SET);
	
	Bias_System(0x14);
	Set_Vop (0XB1);
	Temperature_Control (Vlcd_TEMP_COEF_0);
	Function_Set(PD_RESET, V_RESET, H_RESET);
	Display_Control(NORMAL_MODE);
	
	Clear_Display();
}

void Write_String_Language(char* turkish_string, char* english_string, uint8_t tr_or_en){
    if(tr_or_en == 1){
        Write_String(turkish_string);
    }else{
        Write_String(english_string);
    }
}

void Write_String_Language_Address(uint8_t x_tr, uint8_t y_tr, char* tr_string, uint8_t x_en, uint8_t y_en, char* en_string, uint8_t tr_or_en){
    if(tr_or_en == 1){
				Set_Address(x_tr, y_tr);
        Write_String(tr_string);
    }else{
			  Set_Address(x_en, y_en);
        Write_String(en_string);
    }
}







